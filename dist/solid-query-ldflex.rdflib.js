var solid="object"==typeof solid?solid:{};solid.data=function(t){var e={};function r(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=19)}([function(t,e,r){var n=r(14);t.exports=n},function(t,e,r){"use strict";function n(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}Object.defineProperty(e,"__esModule",{value:!0}),n(r(10)),n(r(7))},function(t){t.exports=JSON.parse('{"@context":{"acl":"http://www.w3.org/ns/auth/acl#","app":"http://www.w3.org/ns/solid/app#","as":"https://www.w3.org/ns/activitystreams#","cert":"http://www.w3.org/ns/auth/cert#","dc":"http://purl.org/dc/elements/1.1/","dct":"http://purl.org/dc/terms/","foaf":"http://xmlns.com/foaf/0.1/","ldp":"http://www.w3.org/ns/ldp#","owl":"http://www.w3.org/2002/07/owl#","pim":"http://www.w3.org/ns/pim/space#","rdf":"http://www.w3.org/1999/02/22-rdf-syntax-ns#","rdfs":"http://www.w3.org/2000/01/rdf-schema#","schema":"http://schema.org/","sioc":"http://rdfs.org/sioc/ns#","solid":"http://www.w3.org/ns/solid/terms#","stat":"http://www.w3.org/ns/posix/stat#","ui":"http://www.w3.org/ns/ui#","vcard":"http://www.w3.org/2006/vcard/ns#","xsd":"http://www.w3.org/2001/XMLSchema#","accessControl":"acl:accessControl","accessTo":"acl:accessTo","accessToClass":"acl:accessToClass","agent":"acl:agent","agents":"acl:agent","agentClass":"acl:agentClass","agentClasses":"acl:agentClass","agentGroup":"acl:agentGroup","agentGroups":"acl:agentGroup","defaultAcl":"acl:default","defaultAclForNew":"acl:defaultForNew","delegates":"acl:delegates","mode":"acl:mode","modes":"acl:mode","origin":"acl:origin","origins":"acl:origin","actor":"as:actor","attachment":"as:attachment","attributedTo":"as:attributedTo","author":"as:author","bcc":"as:bcc","bto":"as:bto","cc":"as:cc","inReplyTo":"as:inReplyTo","object":"as:object","publicationDate":"as:published","subject":"as:subject","summary":"as:summary","target":"as:target","to":"as:to","abstract":"dc:abstract","abstracts":"dc:abstract","created":"dc:created","license":"dc:license","modified":"dc:modified","title":"dc:title","titles":"dc:title","account":"foaf:account","accounts":"foaf:account","age":"foaf:age","basedNear":"foaf:based_near","birthday":"foaf:birthday","blog":"foaf:weblog","depiction":"foaf:depiction","depicts":"foaf:depicts","email":"foaf:mbox","familyName":"foaf:familyName","firstName":"foaf:givenName","friend":"foaf:knows","friends":"foaf:knows","gender":"foaf:gender","givenName":"foaf:givenName","homepage":"foaf:homepage","image":"foaf:img","images":"foaf:img","interest":"foaf:topic_interest","interests":"foaf:topic_interest","knows":"foaf:knows","lastName":"foaf:familyName","logo":"foaf:logo","made":"foaf:made","maker":"foaf:maker","member":"foaf:member","name":"foaf:name","nick":"foaf:nick","page":"foaf:page","pages":"foaf:page","primaryTopic":"foaf:primaryTopic","primaryTopicOf":"foaf:primaryTopicOf","publication":"foaf:publications","publications":"foaf:publications","thumbnail":"foaf:thumbnail","thumbnails":"foaf:thumbnail","topic":"foaf:topic","topics":"foaf:topic","inbox":"ldp:inbox","inboxes":"ldp:inbox","storage":"pim:storage","preferences":"pim:preferencesFile","workspace":"pim:workspace","type":"rdf:type","types":"rdf:type","comment":"rdfs:comment","comments":"rdfs:comment","label":"rdfs:label","labels":"rdfs:label","seeAlso":"rdfs:seeAlso","definedBy":"rdfs:isDefinedBy","oidcIssuer":"solid:oidcIssuer","publicTypeIndex":"solid:publicTypeIndex","publicTypeIndexes":"solid:publicTypeIndex","privateTypeIndex":"solid:privateTypeIndex","privateTypeIndexes":"solid:privateTypeIndex"}}')},,function(t,e){t.exports=$rdf},function(t,e){t.exports=solid.auth},function(t,e,r){r(11),t.exports=self.fetch.bind(self)},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(s,a){function o(t){try{c(n.next(t))}catch(t){a(t)}}function i(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){t.done?s(t.value):new r((function(e){e(t.value)})).then(o,i)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),r(6);e.FetchDocumentLoader=class{load(t){return n(this,void 0,void 0,(function*(){const e=yield fetch(t,{headers:{accept:"application/ld+json"}});if(e.ok)return yield e.json();throw new Error(`No valid context was found at ${t}: ${e.statusText}`)}))}}},function(t,e){function r(){this.value=""}r.prototype.equals=function(t){return!!t&&t.termType===this.termType},r.prototype.termType="DefaultGraph",t.exports=r},function(t,e){function r(t){this.value=t}r.prototype.equals=function(t){return!!t&&t.termType===this.termType&&t.value===this.value},r.prototype.termType="NamedNode",t.exports=r},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(s,a){function o(t){try{c(n.next(t))}catch(t){a(t)}}function i(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){t.done?s(t.value):new r((function(e){e(t.value)})).then(o,i)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),r(6);const s=r(12),a=r(7);class o{constructor(t){t=t||{},this.documentLoader=t.documentLoader||new a.FetchDocumentLoader,this.documentCache={},this.validate=!t.skipValidation,this.expandContentTypeToBase=t.expandContentTypeToBase}static isCompactIri(t){return t.indexOf(":")>=0&&!(t&&"#"===t[0])}static getPrefix(t,e){if(t&&"#"===t[0])return null;const r=t.indexOf(":");if(r>=0){if(t.length>r+1&&"/"===t.charAt(r+1)&&"/"===t.charAt(r+2))return null;const n=t.substr(0,r);if("_"===n)return null;if(e[n])return n}return null}static getContextValueId(t){if(null===t||"string"==typeof t)return t;const e=t["@id"];return e||null}static expandTerm(t,e,r){o.assertNormalized(e);const n=e[t];if(null===n||n&&null===n["@id"])return null;if(n&&r){const e=this.getContextValueId(n);if(e&&e!==t)return e}const a=o.getPrefix(t,e);if(a){const r=this.getContextValueId(e[a]);if(r)return r+t.substr(a.length+1)}else{if(r&&e["@vocab"]&&"@"!==t.charAt(0)&&!o.isCompactIri(t))return e["@vocab"]+t;if(!r&&e["@base"]&&"@"!==t.charAt(0)&&!o.isCompactIri(t))return s.resolve(t,e["@base"])}return t}static compactIri(t,e,r){if(o.assertNormalized(e),r&&e["@vocab"]&&t.startsWith(e["@vocab"]))return t.substr(e["@vocab"].length);if(!r&&e["@base"]&&t.startsWith(e["@base"]))return t.substr(e["@base"].length);const n={prefix:"",suffix:t};for(const s in e){const a=e[s];if(a&&!s.startsWith("@")){const e=this.getContextValueId(a);if(t.startsWith(e)){const a=t.substr(e.length);if(a)a.length<n.suffix.length&&(n.prefix=s,n.suffix=a);else if(r)return s}}}return n.prefix?n.prefix+":"+n.suffix:t}static assertNormalized(t){if("string"==typeof t||Array.isArray(t)||t["@context"])throw new Error("The given context is not normalized. Make sure to call ContextParser.parse() first.")}static isPrefixValue(t){return t&&("string"==typeof t||t["@id"]||t["@type"])}static isValidIri(t){return o.IRI_REGEX.test(t)}static idifyReverseTerms(t){for(const e of Object.keys(t)){const r=t[e];if(r&&"object"==typeof r&&r["@reverse"]&&!r["@id"]){if("string"!=typeof r["@reverse"])throw new Error(`Invalid @reverse value: '${r["@reverse"]}'`);r["@id"]=r["@reverse"],r["@reverse"]=!0}}return t}static expandPrefixedTerms(t,e){for(const r of Object.keys(t))if(o.EXPAND_KEYS_BLACKLIST.indexOf(r)<0){if("@"===r[0]&&o.ALIAS_KEYS_BLACKLIST.indexOf(r)>=0)throw new Error(`Keywords can not be aliased to something else.\nTried mapping ${r} to ${t[r]}`);for(;o.isPrefixValue(t[r]);){const n=t[r];let s=!1;if("string"==typeof n)t[r]=o.expandTerm(n,t,!0),s=s||n!==t[r];else{const a=n["@id"],i=n["@type"];a&&(t[r]["@id"]=o.expandTerm(a,t,!0),s=s||a!==t[r]["@id"]),i&&"@vocab"!==i&&(t[r]["@type"]=o.expandTerm(i,t,!0),e&&i===t[r]["@type"]&&(t[r]["@type"]=o.expandTerm(i,t,!1)),s=s||i!==t[r]["@type"])}if(!s)break}}return t}static normalize(t){for(const e of Object.keys(t))if("@language"===e&&"string"==typeof t[e])t[e]=t[e].toLowerCase();else{const r=t[e];r&&"object"==typeof r&&"string"==typeof r["@language"]&&(r["@language"]=r["@language"].toLowerCase())}return t}static validate(t){for(const e of Object.keys(t)){const r=t[e],n=typeof r;if("@"===e[0])switch(e.substr(1)){case"vocab":if(null!==r&&"string"!==n)throw new Error("Found an invalid @vocab IRI: "+r);break;case"base":if(null!==r&&"string"!==n)throw new Error("Found an invalid @base IRI: "+t[e]);break;case"language":if(null!==r&&"string"!==n)throw new Error("Found an invalid @language string: "+r)}if(null!==r)switch(n){case"string":break;case"object":if(!(o.isCompactIri(e)||"@id"in r||("@id"===r["@type"]?t["@base"]:t["@vocab"])))throw new Error(`Missing @id in context entry: '${e}': '${JSON.stringify(r)}'`);for(const t of Object.keys(r)){const n=r[t];if(n)switch(t){case"@id":if("@"===n[0]&&"@type"!==n&&"@id"!==n)throw new Error(`Illegal keyword alias in term value, found: '${e}': '${JSON.stringify(r)}'`);break;case"@type":if("@id"!==n&&"@vocab"!==n&&("_"===n[0]||!o.isValidIri(n)))throw new Error(`A context @type must be an absolute IRI, found: '${e}': '${n}'`);break;case"@reverse":if("string"==typeof n&&r["@id"]&&r["@id"]!==n)throw new Error(`Found non-matching @id and @reverse term values in '${e}':'${n}' and '${r["@id"]}'`);break;case"@container":if("@list"===n&&r["@reverse"])throw new Error(`Term value can not be @container: @list and @reverse at the same time on '${e}'`);if(o.CONTAINERS.indexOf(n)<0)throw new Error(`Invalid term @container for '${e}' ('${n}'), must be one of ${o.CONTAINERS.join(", ")}`);break;case"@language":if(null!==n&&"string"!=typeof n)throw new Error(`Found an invalid term @language string in: '${e}': '${JSON.stringify(r)}'`)}}break;default:throw new Error(`Found an invalid term value: '${e}': '${r}'`)}}}static normalizeContextIri(t,e){if(!o.isValidIri(t)&&(t=s.resolve(t,e),!o.isValidIri(t)))throw new Error("Invalid context IRI: "+t);return t}parse(t,{baseIri:e,parentContext:r,external:a}={}){return n(this,void 0,void 0,(function*(){if(null==t)return e?{"@base":e}:{};if("string"==typeof t)return this.parse(yield this.load(o.normalizeContextIri(t,e)),{baseIri:e,parentContext:r,external:!0});if(Array.isArray(t)){return(yield Promise.all(t.map(t=>"string"==typeof t?this.load(o.normalizeContextIri(t,e)):t))).reduce((t,r)=>t.then(t=>this.parse(r,{baseIri:t&&t["@base"]||e,external:a,parentContext:t})),Promise.resolve(r))}if("object"==typeof t){if(t["@context"])return yield this.parse(t["@context"],{baseIri:e,parentContext:r,external:a});t=JSON.parse(JSON.stringify(t));let n={};return a&&delete t["@base"],e&&("@base"in t?null===t["@base"]||o.isValidIri(t["@base"])||(t["@base"]=s.resolve(t["@base"],e)):t["@base"]=e),n=Object.assign({},n,r,t),o.idifyReverseTerms(n),o.expandPrefixedTerms(n,this.expandContentTypeToBase),o.normalize(n),this.validate&&o.validate(n),n}throw new Error("Tried parsing a context that is not a string, array or object, but got "+t)}))}load(t){return n(this,void 0,void 0,(function*(){const e=this.documentCache[t];return e?Array.isArray(e)?e.slice():Object.assign({},e):this.documentCache[t]=(yield this.documentLoader.load(t))["@context"]}))}}o.IRI_REGEX=/^([A-Za-z][A-Za-z0-9+-.]*|_):[^ "<>{}|\\\[\]`]*$/,o.EXPAND_KEYS_BLACKLIST=["@base","@vocab","@language"],o.ALIAS_KEYS_BLACKLIST=["@container","@graph","@id","@index","@list","@nest","@none","@prefix","@reverse","@set","@type","@value"],o.CONTAINERS=["@list","@set","@index","@language"],e.ContextParser=o},function(t,e,r){"use strict";r.r(e),r.d(e,"Headers",(function(){return p})),r.d(e,"Request",(function(){return v})),r.d(e,"Response",(function(){return T})),r.d(e,"DOMException",(function(){return j})),r.d(e,"fetch",(function(){return _}));var n="URLSearchParams"in self,s="Symbol"in self&&"iterator"in Symbol,a="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(t){return!1}}(),o="FormData"in self,i="ArrayBuffer"in self;if(i)var c=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(t){return t&&c.indexOf(Object.prototype.toString.call(t))>-1};function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function d(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return s&&(e[Symbol.iterator]=function(){return e}),e}function p(t){this.map={},t instanceof p?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function h(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function y(t){return new Promise((function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}}))}function w(t){var e=new FileReader,r=y(e);return e.readAsArrayBuffer(t),r}function b(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(t){var e;this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:a&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:o&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:n&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():i&&a&&((e=t)&&DataView.prototype.isPrototypeOf(e))?(this._bodyArrayBuffer=b(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):i&&(ArrayBuffer.prototype.isPrototypeOf(t)||u(t))?this._bodyArrayBuffer=b(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var t=h(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(w)}),this.text=function(){var t,e,r,n=h(this);if(n)return n;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,r=y(e),e.readAsText(t),r;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),r=new Array(e.length),n=0;n<e.length;n++)r[n]=String.fromCharCode(e[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(x)}),this.json=function(){return this.text().then(JSON.parse)},this}p.prototype.append=function(t,e){t=l(t),e=f(e);var r=this.map[t];this.map[t]=r?r+", "+e:e},p.prototype.delete=function(t){delete this.map[l(t)]},p.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},p.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},p.prototype.set=function(t,e){this.map[l(t)]=f(e)},p.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},p.prototype.keys=function(){var t=[];return this.forEach((function(e,r){t.push(r)})),d(t)},p.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),d(t)},p.prototype.entries=function(){var t=[];return this.forEach((function(e,r){t.push([r,e])})),d(t)},s&&(p.prototype[Symbol.iterator]=p.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function v(t,e){var r,n,s=(e=e||{}).body;if(t instanceof v){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new p(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,s||null==t._bodyInit||(s=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new p(e.headers)),this.method=(r=e.method||this.method||"GET",n=r.toUpperCase(),m.indexOf(n)>-1?n:r),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&s)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(s)}function x(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var r=t.split("="),n=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(s))}})),e}function T(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new p(e.headers),this.url=e.url||"",this._initBody(t)}v.prototype.clone=function(){return new v(this,{body:this._bodyInit})},g.call(v.prototype),g.call(T.prototype),T.prototype.clone=function(){return new T(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},T.error=function(){var t=new T(null,{status:0,statusText:""});return t.type="error",t};var E=[301,302,303,307,308];T.redirect=function(t,e){if(-1===E.indexOf(e))throw new RangeError("Invalid status code");return new T(null,{status:e,headers:{location:t}})};var j=self.DOMException;try{new j}catch(t){(j=function(t,e){this.message=t,this.name=e;var r=Error(t);this.stack=r.stack}).prototype=Object.create(Error.prototype),j.prototype.constructor=j}function _(t,e){return new Promise((function(r,n){var s=new v(t,e);if(s.signal&&s.signal.aborted)return n(new j("Aborted","AbortError"));var o=new XMLHttpRequest;function i(){o.abort()}o.onload=function(){var t,e,n={status:o.status,statusText:o.statusText,headers:(t=o.getAllResponseHeaders()||"",e=new p,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var r=t.split(":"),n=r.shift().trim();if(n){var s=r.join(":").trim();e.append(n,s)}})),e)};n.url="responseURL"in o?o.responseURL:n.headers.get("X-Request-URL");var s="response"in o?o.response:o.responseText;r(new T(s,n))},o.onerror=function(){n(new TypeError("Network request failed"))},o.ontimeout=function(){n(new TypeError("Network request failed"))},o.onabort=function(){n(new j("Aborted","AbortError"))},o.open(s.method,s.url,!0),"include"===s.credentials?o.withCredentials=!0:"omit"===s.credentials&&(o.withCredentials=!1),"responseType"in o&&a&&(o.responseType="blob"),s.headers.forEach((function(t,e){o.setRequestHeader(e,t)})),s.signal&&(s.signal.addEventListener("abort",i),o.onreadystatechange=function(){4===o.readyState&&s.signal.removeEventListener("abort",i)}),o.send(void 0===s._bodyInit?null:s._bodyInit)}))}_.polyfill=!0,self.fetch||(self.fetch=_,self.Headers=p,self.Request=v,self.Response=T)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}(r(13))},function(t,e,r){"use strict";function n(t){const e=[];let r=0;for(;r<t.length;)switch(t[r]){case"/":if("."===t[r+1])if("."===t[r+2]){if(!a(t[r+3])){e.push([]),r++;break}e.pop(),t[r+3]||e.push([]),r+=3}else{if(!a(t[r+2])){e.push([]),r++;break}t[r+2]||e.push([]),r+=2}else e.push([]),r++;break;case"#":case"?":e.length||e.push([]),e[e.length-1].push(t.substr(r)),r=t.length;break;default:e.length||e.push([]),e[e.length-1].push(t[r]),r++}return"/"+e.map(t=>t.join("")).join("/")}function s(t,e){let r=e+1;e>=0?"/"===t[e+1]&&"/"===t[e+2]&&(r=e+3):"/"===t[0]&&"/"===t[1]&&(r=2);const s=t.indexOf("/",r);return s<0?t:t.substr(0,s)+n(t.substr(s))}function a(t){return!t||"#"===t||"?"===t||"/"===t}Object.defineProperty(e,"__esModule",{value:!0}),e.resolve=function(t,e){const r=(e=e||"").indexOf("#");if(r>0&&(e=e.substr(0,r)),!t.length)return e;if(t.startsWith("?")){const r=e.indexOf("?");return r>0&&(e=e.substr(0,r)),e+t}if(t.startsWith("#"))return e+t;if(!e.length)return s(t,t.indexOf(":"));const a=t.indexOf(":");if(a>=0)return s(t,a);const o=e.indexOf(":");if(o<0)throw new Error(`Found invalid baseIRI '${e}' for value '${t}'`);const i=e.substr(0,o+1);if(0===t.indexOf("//"))return i+s(t,a);let c;if(e.indexOf("//",o)===o+1){if(c=e.indexOf("/",o+3),c<0)return e.length>o+3?e+"/"+s(t,a):i+s(t,a)}else if(c=e.indexOf("/",o+1),c<0)return i+s(t,a);if(0===t.indexOf("/"))return e.substr(0,c)+n(t);let u=e.substr(c);const l=u.lastIndexOf("/");return l>=0&&l<u.length-1&&(u=u.substr(0,l+1),"."===t[0]&&"."!==t[1]&&"/"!==t[1]&&t[2]&&(t=t.substr(1))),t=n(t=u+t),e.substr(0,c)+t},e.removeDotSegments=n,e.removeDotSegmentsOfPath=s},function(t,e,r){var n=r(15),s=r(8),a=r(16),o=r(9),i=r(17),c=r(18);function u(){}u.namedNode=function(t){return new o(t)},u.blankNode=function(t){return new n(t)},u.literal=function(t,e){return"string"==typeof e?-1===e.indexOf(":")?new a(t,e):new a(t,null,u.namedNode(e)):new a(t,null,e)},u.defaultGraph=function(){return u.defaultGraphInstance},u.variable=function(t){return new c(t)},u.triple=function(t,e,r){return u.quad(t,e,r)},u.quad=function(t,e,r,n){return new i(t,e,r,n||u.defaultGraphInstance)},u.defaultGraphInstance=new s,t.exports=u},function(t,e){function r(t){this.value=t||"b"+ ++r.nextId}r.prototype.equals=function(t){return!!t&&t.termType===this.termType&&t.value===this.value},r.prototype.termType="BlankNode",r.nextId=0,t.exports=r},function(t,e,r){var n=r(9);function s(t,e,r){this.value=t,this.datatype=s.stringDatatype,this.language="",e?(this.language=e,this.datatype=s.langStringDatatype):r&&(this.datatype=r)}s.prototype.equals=function(t){return!!t&&t.termType===this.termType&&t.value===this.value&&t.language===this.language&&t.datatype.equals(this.datatype)},s.prototype.termType="Literal",s.langStringDatatype=new n("http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"),s.stringDatatype=new n("http://www.w3.org/2001/XMLSchema#string"),t.exports=s},function(t,e,r){var n=r(8);function s(t,e,r,s){this.subject=t,this.predicate=e,this.object=r,this.graph=s||new n}s.prototype.equals=function(t){return!!t&&t.subject.equals(this.subject)&&t.predicate.equals(this.predicate)&&t.object.equals(this.object)&&t.graph.equals(this.graph)},t.exports=s},function(t,e){function r(t){this.value=t}r.prototype.equals=function(t){return!!t&&t.termType===this.termType&&t.value===this.value},r.prototype.termType="Variable",t.exports=r},function(t,e,r){"use strict";r.r(e);const n={};function s(t){return t[Symbol.asyncIterator]().next().then(t=>t.value)}class a{constructor(t,...e){this._isAsync=t.async,this._isFunction=t.function,this._dataProperties=e}static sync(...t){return new a({async:!1},...t)}static syncFunction(...t){return new a({async:!1,function:!0},...t)}static async(...t){return new a({async:!0},...t)}static asyncFunction(...t){return new a({async:!0,function:!0},...t)}handle(t){return this._isFunction?()=>this._resolveDataPath(t):this._resolveDataPath(t)}_resolveDataPath(t){return this._isAsync?this._resolveAsyncDataPath(t):this._resolveSyncDataPath(t)}_resolveSyncDataPath(t){for(const e of this._dataProperties)t=t&&t[e];return t}async _resolveAsyncDataPath(t){for(const e of this._dataProperties)t=t&&await t[e];return t}}var o=r(0);function i(t){return{then:c(t)}}function c(t){return(e,r)=>t().then(e,r)}function u(t){return"function"==typeof t&&(t=function(t){const e=[];let r=t[Symbol.asyncIterator]();return{[Symbol.asyncIterator](){let t=0;return{async next(){if(t<e.length)return e[t++];if(!r)return{done:!0};const n=e[t++]=r.next();return(await n).done&&(r=null),n}}}}}(t())),{[Symbol.asyncIterator]:()=>t[Symbol.asyncIterator](),get then(){return c(()=>s(this))},catch(t){return this.then(null,t)},finally(t){return this.then().finally(t)}}}class l{constructor(t,e){this._mutationType=t,this._allowZeroArgs=e}handle(t,e){return(...r)=>{if(!this._allowZeroArgs&&!r.length)throw new Error("Mutation on ".concat(t," can not be invoked without arguments"));const n=i(()=>this.createMutationExpressions(t,e,r));return t.extendPath({mutationExpressions:n})}}async createMutationExpressions(t,e,r){const n=await e.pathExpression;if(!Array.isArray(n))throw new Error("".concat(t," has no pathExpression property"));if(n.length<2)throw new Error("".concat(t," should at least contain a subject and a predicate"));const s=await this.extractObjects(t,e,r),a=this._mutationType;if(!s)return[{mutationType:a,conditions:n}];if(0===s.length)return[];const{predicate:o}=n.pop();if(!o)throw new Error("Expected predicate in ".concat(t));return[{mutationType:a,conditions:n,predicate:o,objects:s}]}async extractObjects(t,e,r){if(0===r.length)return null;const n=[];for(const s of r)if(s&&s[Symbol.asyncIterator])for await(const r of s)n.push(this.extractObject(t,e,r));else n.push(this.extractObject(t,e,await s));return n}extractObject(t,e,r){if("string"==typeof r)return Object(o.literal)(r);if(r&&r.termType)return r;throw new Error("Invalid object: ".concat(r))}}class f extends l{constructor(){super("DELETE",!0)}}const d=/(SELECT\s+)(\?\S+)/,p=/\}[^}]*$/;function h(t){const{termType:e,value:r}=t;switch(e){case"NamedNode":return r;case"Literal":const{language:n,datatype:s}=t;return"".concat(e,"|").concat(n,"|").concat(s.value,"|").concat(r);default:return"".concat(e,"|").concat(r)}}var y=r(1);class w{constructor(t="ASC"){this.order=t}handle(t,e){return(...r)=>{if(0===r.length)return e;const[n,...s]=r,{predicate:a}=e[n],o={property:n,predicate:a,sort:this.order},i=t.extendPath(o);return 0===s.length?i:i.sort(...s)}}}const b=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,g=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,m={"\\":"\\\\",'"':'\\"',"\t":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};class v{async handle(t,e){const r=await e.mutationExpressions;if(Array.isArray(r)&&r.length)return r.map(t=>this.mutationExpressionToQuery(t)).join("\n;\n");const n=await e.pathExpression;if(!Array.isArray(n))throw new Error("".concat(t," has no pathExpression property"));return this.pathExpressionToQuery(t,e,n)}pathExpressionToQuery(t,e,r){if(r.length<2&&!t.finalClause)throw new Error("".concat(t," should at least contain a subject and a predicate"));let n="?subject",s=[],a=[];r.length>1&&(n=this.createVar(t.property),({queryVar:n,sorts:s,clauses:a}=this.expressionToTriplePatterns(r,n))),t.finalClause&&a.push(t.finalClause(n));const o=t.distinct?"DISTINCT ":"",i="SELECT ".concat(o).concat(t.select?t.select:n),c=" WHERE {\n  ".concat(a.join("\n  "),"\n}"),u=s.map(({order:t,variable:e})=>"".concat(t,"(").concat(e,")")),l=0===u.length?"":"\nORDER BY ".concat(u.join(" "));return"".concat(i).concat(c).concat(l)}mutationExpressionToQuery({mutationType:t,conditions:e,predicate:r,objects:n}){const s={};let a,o;if(1===e.length)a=this.termToString(e[0].subject),o=[];else{const t=e[e.length-1].predicate;a=this.createVar(t.value,s),({queryVar:a,clauses:o}=this.expressionToTriplePatterns(e,a,s))}const i=n&&n.map(t=>this.termToString(t)).join(", "),c=i?"".concat(a," ").concat(this.termToString(r)," ").concat(i,"."):o[o.length-1];return 0===o.length?"".concat(t," DATA {\n  ").concat(c,"\n}"):"".concat(t," {\n  ").concat(c,"\n} WHERE {\n  ").concat(o.join("\n  "),"\n}")}expressionToTriplePatterns([t,...e],r,n={}){const s=e.length-1;let a=this.termToString(function(t){if("BlankNode"!==t.termType)return t;t.skolemized||(t.skolemized=Object(o.namedNode)("urn:ldflex:sk".concat(T++)));return t.skolemized}(t.subject)),i=a;const c=[],u=e.map((t,e)=>{const o=a,{predicate:u}=t;a=e<s?this.createVar("v".concat(e),n):r;const l="".concat(o," ").concat(this.termToString(u)," ").concat(a,".");return t.sort?(c.push({variable:a,order:t.sort}),a=i):i=a,l});return{queryVar:i,sorts:c,clauses:u}}createVar(t="",e){let r=0,n="?".concat(t.match(/[a-z0-9]*$/i)[0]||"result");if(e){for(;e[n];)n="?".concat(t,"_").concat(r++);e[n]=!0}return n}termToString(t){let{value:e}=t;switch(b.test(e)&&(e=e.replace(g,x)),t.termType){case"NamedNode":return"<".concat(e,">");case"BlankNode":return"_:".concat(e);case"Literal":let r="";return t.language?r="@".concat(t.language):"http://www.w3.org/2001/XMLSchema#string"!==t.datatype.value&&(r="^^<".concat(t.datatype.value,">")),'"'.concat(e,'"').concat(r);default:throw new Error("Could not convert a term of type ".concat(t.termType))}}}function x(t){let e=m[t];return void 0===e&&(1===t.length?(e=t.charCodeAt(0).toString(16),e="\\u0000".substr(0,6-e.length)+e):(e=(1024*(t.charCodeAt(0)-55296)+t.charCodeAt(1)+9216).toString(16),e="\\U00000000".substr(0,10-e.length)+e)),e}let T=0;var E={__esModule:()=>{},then:new class{handle({subject:t},e){return t?t.then&&c(()=>e.subject):c(()=>s(e.results))}},[Symbol.asyncIterator]:new class{handle({subject:t},e){return t?()=>{return t=e.subject,{async next(){if(t!==n){const e=await t;return t=n,{value:e}}return{done:!0}}};var t}:()=>e.results[Symbol.asyncIterator]()}},subject:new class{handle(t){let{subject:e,parent:r}=t;for(;!e&&r;)({subject:e,parent:r}=r);return e?Promise.resolve(e).then(e=>t.extendPath({subject:e},null)):void 0}},predicate:new class{handle(t){const{predicate:e}=t;return e?Promise.resolve(e).then(e=>t.extendPath({subject:e},null)):void 0}},properties:new class{handle(t,e){return u(this._handle(t,e))}async*_handle(t,e){const r=await t.settings.parsedContext||{};for await(const t of e.predicates)yield y.ContextParser.compactIri("".concat(await t),r,!0)}},predicates:new class{handle(t){return t.extendPath({distinct:!0,select:"?predicate",finalClause:t=>"".concat(t," ?predicate ?object."),property:t.property})}},pathExpression:new class{async handle(t){const e=[];let r=t;for(;r.parent;)r.predicate&&e.unshift({predicate:await r.predicate,sort:r.sort}),r=r.parent;if(!r.subject)throw new Error("Expected root subject in ".concat(r));const n=await r.subject;return e.unshift({subject:n}),e}},sparql:new v,subjects:new class{handle(t){return t.extendPath({distinct:!0,select:"?subject",finalClause:()=>"?subject ?predicate ?object.",property:t.property})}},results:new class{async*handle(t,e){const r=await t.resultsCache;if(r){for(const t of r)yield t;return}const{queryEngine:n}=t.settings;if(!n)throw new Error("".concat(t," has no queryEngine setting"));const s=await e.sparql;if(!s)throw new Error("".concat(t," has no sparql property"));for await(const e of n.execute(s))yield this.extractTerm(e,t)}extractTerm(t,e){if(1!==t.size)throw new Error("Only single-variable queries are supported");const r=t.values().next().value;return e.extendPath({subject:r},null)}},sort:new w("ASC"),sortDesc:new w("DESC"),preload:new class{handle(t,e){return async(...r)=>{if(r.length>0){const n=await Promise.all(r.map(async t=>(await e[t].predicate).value));t.resultsCache=await this.createResultsCache(n,t,e)}return e}}async createResultsCache(t,e,r){const{query:n,vars:s,resultVar:a}=await this.createQuery(t,r),{settings:{queryEngine:o}}=e,i=o.execute(n),c={},u={};for await(const r of i){const n=r.get(a),o=h(n);if(!(o in c)){const r=u[o]={};for(const e of t)r[e]=[];const s={subject:n,propertyCache:r};c[o]=e.extendPath(s,null)}const i=u[o];for(let n=0;n<s.length;n++){const a=r.get(s[n]);if(a){const r=e.extendPath({subject:a},null);i[t[n]].push(r)}}}return Object.values(c)}async createQuery(t,e){const r=await e.sparql,n=d.exec(r);if(!n)throw new Error("Unexpected path query: ".concat(r));const s=n[2],a=t.map((t,e)=>"?preload_".concat(e)),o=t.map((t,e)=>"    { ".concat(s," <").concat(t,"> ").concat(a[e],". }")).join("\n    UNION\n");return{query:r.replace(d,"$1$2 ".concat(a.join(" "))).replace(p,"  OPTIONAL {\n".concat(o,"\n  }\n$&")),vars:a,resultVar:s}}},mutationExpressions:new class{async handle(t){const e=[];let r=t;for(;r;)r.mutationExpressions&&e.unshift(...await r.mutationExpressions),r=r.parent;return e}},add:new class extends l{constructor(){super("INSERT",!1)}},set:new class{handle(t,e){return(...t)=>e.delete().add(...t)}},replace:new class{handle(t,e){return function(t,...r){if(!t||!r.length)throw new Error("Replacing values requires at least two arguments, old value followed by all new values");return e.delete(t).add(...r)}}},delete:new f,termType:_("termType"),value:_("value"),datatype:_("datatype"),language:_("language"),equals:a.sync("subject","equals"),toString:a.syncFunction("subject","value"),toPrimitive:a.syncFunction("subject","value"),toArray:new class{handle(t,e){return async t=>{const r=[];if(e&&"function"==typeof e[Symbol.asyncIterator]){"function"!=typeof t&&(t=t=>t);let n=0;for await(const s of e)r.push(await t(s,n++))}return r}}},termTypes:j((t,e)=>e.toArray(t=>t.termType)),values:j((t,e)=>e.toArray(t=>t.value)),datatypes:j((t,e)=>e.toArray(t=>t.datatype)),languages:j((t,e)=>e.toArray(t=>t.language)),resolve:new class{handle(t,e){return(t="",r=e)=>{const n=t.replace(/^(https?:\/\/[^()[\]'"]+)$/,'["$1"]').replace(/^(?=[a-z$_])/i,".").replace(/\[([^'"`\](]*)\]/g,'["$1"]'),s='"use strict";return ldflex'.concat(n);let a;try{a=Function("ldflex",s)}catch({message:e}){throw new Error('Expression "'.concat(t,'" is invalid: ').concat(e))}return a(r)}}}};function j(t){return{handle:t}}function _(t){return j((e,r)=>{const{subject:n}=e,s=n&&n[t];return void 0!==s?s:r.then(e=>e&&e[t])})}const A=Object.create(null);class P{constructor({handlers:t=A,resolvers:e=[]}={}){this._handlers=t,this._resolvers=e}createPath(t={},e){void 0===e&&([e,t]=[t,{}]);const r={settings:t,...e},n=r.proxy=new Proxy(r,this);if(!r.extendPath){const e=this;r.extendPath=function r(n,s=this){return e.createPath(t,{parent:s,extendPath:r,...n})}}return n}get(t,e){const r=this._handlers[e];if(r&&"function"==typeof r.handle)return r.handle(t,t.proxy);for(const r of this._resolvers)if(r.supports(e))return r.resolve(e,t,t.proxy)}}class O{constructor(...t){this._context=Promise.resolve({}),this.extendContext(...t)}supports(t){return"string"==typeof t}resolve(t,e){const r=i(()=>this.expandProperty(t)),n=this.getResultsCache(e,r);return e.extendPath({property:t,predicate:r,resultsCache:n})}async expandProperty(t){t=t.replace(/^([a-z][a-z0-9]*)[_$]/i,"$1:");const e=await this._context,r=y.ContextParser.expandTerm(t,e,!0);if(!y.ContextParser.isValidIri(r))throw new Error("The JSON-LD context cannot expand the '".concat(t,"' property"));return Object(o.namedNode)(r)}async extendContext(...t){await(this._context=this._context.then(e=>(new y.ContextParser).parse([e,...t])))}getResultsCache(t,e){let{propertyCache:r}=t;return r&&i(async()=>(r=await r,r&&r[(await e).value]))}}class S{constructor(t,e){this._settings=t={...t},this._data=e={...e};const r=t.handlers||E;for(const t in r)r[t]=I(r[t]);for(const t of Object.getOwnPropertySymbols(r))r[t]=I(r[t]);const n=(t.resolvers||[]).map(C);t.context?(n.push(new O(t.context)),t.parsedContext=(new y.ContextParser).parse(t.context)):t.context=t.parsedContext={},this._pathProxy=new P({handlers:r,resolvers:n}),delete t.handlers,delete t.resolvers}create(t={},e){return e||([e,t]=[t,null]),this._pathProxy.createPath(Object.assign(Object.create(null),this._settings,t),Object.assign(Object.create(null),this._data,e))}}function I(t){return"function"==typeof t.handle?t:{handle:t}}function C(t){return"function"==typeof t.resolve?t:{supports:R,resolve:t}}function R(){return!0}S.defaultHandlers=E;var N=r(2);const{as:k}=N["@context"];class L{constructor({activitiesPath:t="/public/activities"}={}){this.requireUser=!0,this.activitiesPath=t}handle(t,e){const r=this,{root:n}=e,{settings:{queryEngine:s}}=t;return(t=k+"Like")=>u((async function*(){let a;try{a=await n.user}catch(t){if(r.requireUser)throw t;return}const i=await n.user.pim$storage,c=new URL(r.activitiesPath,i||a).href,u=[],l=Object(o.namedNode)(a);t=Object(o.namedNode)(t);for await(const n of e)if("NamedNode"===n.termType){const e={actor:l,type:t,object:n};for await(const t of r.createResults(e,c,s))u.push(t)}for(const t of await r.processResults(u,c,s))yield n[t.value]}))}async processResults(t){return t}}const{termToString:D}=v.prototype;function U(t,e){for(const r in e)t=t.replace(new RegExp("_:"+r,"g"),D(e[r]));return t}function q(...t){return{size:t.length,values:()=>({next:()=>({value:t.shift()})})}}var B="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),$=new Uint8Array(16);function F(){if(!B)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return B($)}for(var V=[],M=0;M<256;++M)V[M]=(M+256).toString(16).substr(1);var z=function(t,e){var r=e||0,n=V;return[n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]]].join("")};var G=function(t,e,r){var n=e&&r||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var s=(t=t||{}).random||(t.rng||F)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e)for(var a=0;a<16;++a)e[n+a]=s[a];return e||z(s)};const{xsd:H}=N["@context"];const Q=["?subject","?predicate","?object"];class W{constructor(t,e){this._paths=t,this._source=e}supports(t){return"string"==typeof t}resolve(t,{settings:e}){return this._createSubjectPath(Object(o.namedNode)(t),e)}_createSubjectPath(t,{createQueryEngine:e}){const r=e(this._source||Promise.resolve(t).catch(()=>null));return this._paths.create({queryEngine:r},{subject:t})}}class K{constructor(t){this._paths=t}handle({settings:t}){return e=>new S({handlers:{...E},resolvers:[new W(this._paths,e)]}).create(t,{})}}var X=r(5),J=r.n(X);class Y extends W{handle({settings:t}){const e=this.getWebId().then(o.namedNode);return this._createSubjectPath(e,t)}async getWebId(){const t=await J.a.currentSession();if(!t)throw new Error("Cannot resolve user path: no user logged in");return t.webId}}const{as:Z}=N["@context"],tt=new class extends O{constructor(t){super(t);const e=this._exposedContext=Object.create(t["@context"]);Object.defineProperty(e,"extend",{value:(...t)=>this.extendContext(...t)}),Object.defineProperty(e,"then",{value:(t,e)=>this._context.then(t,e)})}handle(){return this._exposedContext}}(N),et={...E,delete:new class extends f{async extractObjects(t,e,r){const n=await super.extractObjects(t,e,r),s=[];for await(const t of e)"BlankNode"!==t.termType&&s.push(t);return n?s.filter(t=>n.some(e=>e.equals(t))):s}},findActivity:new class extends L{constructor(...t){super(...t),this.requireUser=!1}async*createResults(t,e,r){const n=U("SELECT ?activity WHERE {\n  ?activity a _:type;\n      <https://www.w3.org/ns/activitystreams#actor> _:actor;\n      <https://www.w3.org/ns/activitystreams#object> _:object.\n}\n",t);for await(const t of r.execute(n,e))yield t.values().next().value}},likes:(t,e)=>e.findActivity(Z+"Like"),dislikes:(t,e)=>e.findActivity(Z+"Dislike"),follows:(t,e)=>e.findActivity(Z+"Follow"),createActivity:new class extends L{async*createResults(t,e){const r=Object(o.namedNode)(new URL("#"+G(),e).href),n=U("_:id a _:type;\n    <https://www.w3.org/ns/activitystreams#actor> _:actor;\n    <https://www.w3.org/ns/activitystreams#object> _:object;\n    <https://www.w3.org/ns/activitystreams#published> _:published.\n",t={id:r,published:Object(o.literal)((new Date).toISOString(),H+"dateTime"),...t});yield{id:r,insert:n}}async processResults(t,e,r){const n=`INSERT {\n${t.map(t=>t.insert).join("")}}`;return await r.executeUpdate(n,e).next(),t.map(t=>t.id)}},like:(t,e)=>()=>e.createActivity(Z+"Like"),dislike:(t,e)=>()=>e.createActivity(Z+"Dislike"),follow:(t,e)=>()=>e.createActivity(Z+"Follow"),deleteActivity:new class extends L{async*createResults(t,e,r){const n=U("SELECT ?subject ?predicate ?object WHERE {\n  ?subject a _:type;\n      <https://www.w3.org/ns/activitystreams#actor> _:actor;\n      <https://www.w3.org/ns/activitystreams#object> _:object.\n  ?subject ?predicate ?object.\n}\n",t);for await(const t of r.execute(n,e)){const e=Q.map(e=>D(t.get(e)));yield e.join(" ")+".\n"}}async processResults(t,e,r){const n=`DELETE {\n${t.join("")}}`;return await r.executeUpdate(n,e).next(),[]}},unlike:(t,e)=>()=>e.deleteActivity(Z+"Like"),undislike:(t,e)=>()=>e.deleteActivity(Z+"Dislike"),unfollow:(t,e)=>()=>e.deleteActivity(Z+"Follow")};class rt{constructor(t,e){this._source=this.getUpdateSource(t),this._source.catch(()=>null),this._engine=e}async*execute(t,e){yield*/^\s*(?:INSERT|DELETE)/i.test(t)?this.executeUpdate(t,e):this._engine.execute(t,e)}executeUpdate(t,e){let r=!1;return{next:async()=>{if(r)return{done:r};r=!0;const n=await(e?this.getUpdateSource(e):this._source),{ok:s,status:a,statusText:o}=await J.a.fetch(n,{method:"PATCH",headers:{"Content-Type":"application/sparql-update"},body:t});if(!s)throw new Error(`Update query failed (${a}): ${o}`);return await this.clearCache(n),{value:q({ok:s})}},[Symbol.asyncIterator](){return this}}}async getUpdateSource(t){let e=await t;if(e instanceof URL?e=e.href:e&&"string"==typeof e.value&&(e=e.value),"string"==typeof e){if(!/^https?:\/\//.test(e))throw new Error("Can only update an HTTP(S) document.");return e.replace(/#.*/,"")}if(Array.isArray(e)){if(e=await Promise.all(e.map(t=>this.getUpdateSource(t))),e=[].concat(...e).filter(t=>!!t),1!==e.length)throw new Error("Can only update a single source.");return e[0]}throw new Error("Unsupported source: "+e)}clearCache(t){return this._engine.clearCache(t)}}var nt=r(4);var st=class{constructor(t){this._defaultStore=this.readSources(t),this._defaultStore.catch(()=>null)}async*execute(t,e){/^\s*(?:INSERT|DELETE)/i.test(t)&&(yield*this.executeUpdate(t,e));const r=Object(nt.SPARQLToQuery)(t,!0,Object(nt.graph)()),n=await(e?this.readSources(e):this._defaultStore);n.fetcher=null;const s=[];await new Promise((t,e)=>{n.query(r,t=>s.push(t),null,r=>r?e(r):t(s))});const a=new Set(r.vars.map(t=>"?"+t.value));for(const t of s){const e=Object.entries(t).filter(([t])=>a.has(t));yield new Map(e)}}async*executeUpdate(t,e){throw new Error("SPARQL UPDATE queries are unsupported, received: "+t)}async readSources(t,e=Object(nt.graph)()){let r=await t;if(r)if(r instanceof URL?r=r.href:"NamedNode"===r.termType&&(r=r.value),"string"==typeof r){const t=r.replace(/#.*/,""),n=new nt.Fetcher(e);await n.load(t)}else if(Array.isArray(r))await Promise.all(r.map(t=>this.readSources(t,e)));else{if("function"!=typeof r.match)throw new Error("Unsupported source: "+r);{const t=r.match(null,null,null,null);await new Promise((r,n)=>{function s(t){try{e.add(t.subject,t.predicate,t.object,t.graph)}catch(t){a(t)}}function a(e){return t.removeListener("data",s),t.removeListener("end",a),t.removeListener("error",a),e?n(e):r(null)}t.on("data",s),t.on("end",a),t.on("error",a)})}}return e}async clearCache(t){}};e.default=new function(t){let e=null;const r=new S({handlers:{...et,root:()=>e},resolvers:[tt]});return e=new S({handlers:{...E,from:new K(r),user:new Y(r),clearCache:({settings:t})=>e=>t.createQueryEngine().clearCache(e),context:tt},resolvers:[new W(r)],...t}).create(),e}({createQueryEngine:t=>new rt(t,new st(t))})}]).default;
//# sourceMappingURL=solid-query-ldflex.rdflib.js.map